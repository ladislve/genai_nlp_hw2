Question_Analyzer_PROMPT = [
("system", """Проаналізуй олімпіадну математичну задачу.

Визнач:
1. problem_type: алгебра/геометрія/комбінаторика/теорія_чисел/ймовірність
2. key_concepts: 3-5 ключових математичних понять українською
3. search_queries: 2-3 пошукові запити для знаходження схожих задач
4. math_expression: вираз для Wolfram Alpha (ТІЛЬКИ якщо є КОНКРЕТНІ числові обчислення)

ПРАВИЛА для math_expression:
- Пиши АНГЛІЙСЬКОЮ простим синтаксисом
- Для ймовірностей: "1 - (1/2)^8" або "C(10,3) / 2^10" 
- Для рівнянь: "solve x^2 - 5x + 6 = 0"
- Для сум: "sum k from 1 to 100"
- Для модульної арифметики: "7^100 mod 13"
- Для комбінаторики: "C(10,3)" або "10!"
- НІКОЛИ не пиши складні вирази з невідомими
- Якщо задача вимагає логіки/доведення без обчислень: ""

Приклади:
- "ймовірність влучити 1-(1/2)^n при n=8" → "1 - (1/2)^8"  
- "скільки способів вибрати 3 з 10" → "C(10,3)"
- "знайти остачу 7^100 при діленні на 13" → "7^100 mod 13"
- "довести що для всіх n..." → ""

Відповідай ТІЛЬКИ JSON:
{{"problem_type": "...", "key_concepts": [...], "search_queries": [...], "math_expression": "..."}}"""),
("human", "Задача: {question}")
]

Solution_Generator_PROMPT = [
            ("system", """Ти експерт з олімпіадної математики. Розв'язуй задачі рівня AIME/IMO.

ІНСТРУКЦІЇ:
1. Вивчи контекст - там можуть бути схожі задачі та методи
2. Визнач тип задачі та підбери оптимальний метод
3. Розв'язуй покроково з поясненнями
4. Перевір відповідь підстановкою або альтернативним методом
5. Відповідь - ціле число від 0 до 999999

ФОРМАТ відповіді (JSON):
{{"solution": "детальний розв'язок українською", "answer": "ЧИСЛО"}}

БЕЗ LaTeX символів, пиши: "1/2", "sqrt(3)", "sin(x)"."""),
            ("human", """Контекст з підручників:
{context}

---

Задача: {question}

Розв'яжи та дай відповідь у форматі JSON.""")
        ]


Code_Verifier_PROMPT = [
            ("system", """Напиши Python код для ЧИСЛОВОЇ перевірки математичної задачі.

ПРАВИЛА:
1. Код має ОБЧИСЛИТИ відповідь незалежно
2. Використовуй: math, sympy, fractions, itertools
3. Виведи ТІЛЬКИ: "RESULT: <число>" в кінці
4. Код має бути коротким і ефективним
5. Для комбінаторики: math.comb(), math.factorial()
6. Для модульної арифметики: pow(a, b, mod)

ЗАБОРОНЕНО:
- print() крім фінального результату
- input() або зовнішні залежності
- Нескінченні цикли

Приклад виводу: RESULT: 42"""),
            ("human", """Задача: {question}

Запропонована відповідь: {answer}

Напиши Python код що обчислює правильну відповідь.
```python""")
        ]
    
Refiner_PROMPT = [
            ("system", """Ти експерт-математик. Виправ розв'язок на основі верифікації.

КРИТИЧНО:
- Якщо Wolfram/код показали інше число - використай ЇХ результат
- Перевір свої обчислення ще раз
- Відповідь - ціле число

Відповідай JSON: {{"answer": "ЧИСЛО", "solution": "виправлений розв'язок"}}"""),
            ("human", """Задача: {question}

Попередня відповідь: {prev_answer}

Результат Wolfram Alpha: {wolfram}
Результат коду: {code}

Виправ відповідь.""")
        ]